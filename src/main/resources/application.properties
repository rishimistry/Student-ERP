# ==========================================
# 1. SERVER CONFIGURATION
# ==========================================
# Render provides the port via the $PORT env var; defaults to 8080
server.port=${PORT:8080}

# ==========================================
# 2. DATABASE CONFIGURATION (Supabase)
# ==========================================
# We pull these from the Render Dashboard Environment variables
spring.datasource.url=${SPRING_DATASOURCE_URL}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD}
spring.datasource.driver-class-name=org.postgresql.Driver

# ==========================================
# 3. HIKARI CONNECTION POOL (Critical for Free Tiers)
# ==========================================
# We keep the pool small to avoid crashing Render's 512MB RAM limit
spring.datasource.hikari.maximum-pool-size=4
spring.datasource.hikari.minimum-idle=1
# Increased timeout to 30s to handle cross-region network lag
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000

# ==========================================
# 4. JPA / HIBERNATE SETTINGS
# ==========================================
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
# Hibernate 6+ automatically detects the dialect; naming it manually 
# can sometimes cause "Sequence" errors on startup.
spring.jpa.open-in-view=false
spring.jpa.properties.hibernate.format_sql=true

# ==========================================
# 5. THYMELEAF & FILE UPLOADS
# ==========================================
spring.thymeleaf.cache=true
spring.servlet.multipart.enabled=true
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=10MB
# Store uploads in a relative folder on Render's disk
app.upload.dir=uploads/notes

# ==========================================
# 6. SESSION MANAGEMENT
# ==========================================
server.servlet.session.timeout=30m
server.servlet.session.cookie.http-only=true
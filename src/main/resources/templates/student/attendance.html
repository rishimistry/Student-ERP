<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/layout :: head('My Attendance')}"></head>
<body>
    <div class="app-container">
        <nav th:replace="~{fragments/layout :: student-sidebar('attendance')}"></nav>
        
        <main class="main-content">
            <header th:replace="~{fragments/layout :: mobile-header('Attendance')}"></header>
            <header th:replace="~{fragments/layout :: top-navbar('Attendance')}"></header>
            
            <div class="page-content">
                <div class="stat-card" style="margin-bottom: 24px;">
                    <div class="stat-icon" th:classappend="${overallPercentage >= 75} ? 'success' : 'danger'">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
                    </div>
                    <div class="stat-content">
                        <h3>Overall Attendance</h3>
                        <div class="stat-value" th:text="${#numbers.formatDecimal(overallPercentage, 1, 1) + '%'}">0%</div>
                    </div>
                </div>
                
                <div class="card" style="margin-bottom: 24px;">
                    <div class="card-header">
                        <h3 class="card-title">Subject-wise Attendance</h3>
                    </div>
                    <div class="card-body">
                        <div th:if="${attendanceSummary != null and !attendanceSummary.isEmpty()}">
                            <div th:each="item : ${attendanceSummary}" style="margin-bottom: 20px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span style="font-weight: 500;" th:text="${item.subjectName}">Subject</span>
                                    <span th:text="${item.present + '/' + item.total}" style="color: var(--text-secondary);">0/0</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <div class="progress" style="flex: 1;">
                                        <div class="progress-bar" 
                                             th:classappend="${item.percentage >= 75} ? 'success' : (${item.percentage >= 50} ? 'warning' : 'danger')"
                                             th:style="'width: ' + ${item.percentage} + '%'"></div>
                                    </div>
                                    <span style="min-width: 50px; text-align: right;" th:text="${#numbers.formatDecimal(item.percentage, 1, 1) + '%'}">0%</span>
                                </div>
                            </div>
                        </div>
                        <div th:if="${attendanceSummary == null or attendanceSummary.isEmpty()}" class="empty-state">
                            <p>No attendance records available</p>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Attendance History</h3>
                    </div>
                    <div class="card-body">
                        <form th:action="@{/student/attendance}" method="get" style="margin-bottom: 20px;">
                            <div class="form-group" style="margin-bottom: 0; max-width: 300px;">
                                <select name="subjectId" class="form-control" onchange="this.form.submit()">
                                    <option value="">Select Subject to View History</option>
                                    <option th:each="subject : ${subjects}" th:value="${subject.id}" 
                                            th:text="${subject.subjectName}"
                                            th:selected="${selectedSubject != null and selectedSubject.id == subject.id}">Subject</option>
                                </select>
                            </div>
                        </form>
                        
                        <div th:if="${records != null}" class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Status</th>
                                        <th>Remarks</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="record : ${records}">
                                        <td th:text="${#temporals.format(record.date, 'EEEE, MMM dd, yyyy')}">Monday, Jan 01, 2024</td>
                                        <td>
                                            <span class="badge" 
                                                  th:classappend="${record.status.name() == 'PRESENT'} ? 'badge-success' : (${record.status.name() == 'LATE'} ? 'badge-warning' : 'badge-danger')"
                                                  th:text="${record.status}">Present</span>
                                        </td>
                                        <td th:text="${record.remarks ?: '-'}">-</td>
                                    </tr>
                                </tbody>
                            </table>
                            <div th:if="${#lists.isEmpty(records)}" class="empty-state">
                                <p>No attendance records for this subject</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        
        <nav th:replace="~{fragments/layout :: student-bottom-nav('attendance')}"></nav>
        <div th:replace="~{fragments/layout :: student-mobile-menu('attendance')}"></div>
    </div>
    <th:block th:replace="~{fragments/layout :: mobile-script}"></th:block>
</body>
</html>
